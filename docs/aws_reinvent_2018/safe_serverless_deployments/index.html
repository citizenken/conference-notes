<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='flexible schema much easier to deal with when using serverless  don&rsquo;t need to deal with updates  lambda@the edge is like lamdba, but at the edge of your network, so it can do smarter routing to resources for ex.  for ex. feature flags to give beta version to a particular company  when you update a lambda, it creates an immutable version ID
 Aliases can be defined and linked to version IDs Allows for ex.'>
<meta name='theme-color' content='#ffcd00'>

<meta property='og:title' content='SRV343-R1: Best Practices for Safe Deployments on AWS Lambda and Amazon API Gateway • My New Hugo Site'>
<meta property='og:description' content='flexible schema much easier to deal with when using serverless  don&rsquo;t need to deal with updates  lambda@the edge is like lamdba, but at the edge of your network, so it can do smarter routing to resources for ex.  for ex. feature flags to give beta version to a particular company  when you update a lambda, it creates an immutable version ID
 Aliases can be defined and linked to version IDs Allows for ex.'>
<meta property='og:url' content='https://citizenken.github.io/reinvent_2018_notes/aws_reinvent_2018/safe_serverless_deployments/'>
<meta property='og:site_name' content='My New Hugo Site'>
<meta property='og:type' content='article'><meta property='article:section' content='aws_reinvent_2018'><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.45.1" />

  <title>SRV343-R1: Best Practices for Safe Deployments on AWS Lambda and Amazon API Gateway • My New Hugo Site</title>
  <link rel='canonical' href='https://citizenken.github.io/reinvent_2018_notes/aws_reinvent_2018/safe_serverless_deployments/'>
  
  
  <link rel='icon' href='https://citizenken.github.io/reinvent_2018_notes/favicon.ico'>
<link rel='stylesheet' href='https://citizenken.github.io/reinvent_2018_notes/assets/css/main.4a10984a.css'><style>
:root{--color-accent:#ffcd00;}
</style>

  

</head>
<body class='page type-aws_reinvent_2018 has-sidebar'>

  <div class='site'><div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'>Skip to Main Menu</a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='https://citizenken.github.io/reinvent_2018_notes/'>
        <img src='https://citizenken.github.io/reinvent_2018_notes/images/logo.png'>
      </a>
    </div>
    
    <h2 class='title site-title '>
    My New Hugo Site
    </h2>
    <div class='desc'>
    Minimalist theme for Hugo
    </div>
  </header>

</section>
<section class='widget widget-search sep-after'>
  <header>
    <h4 class='title widget-title'>Search</h4>
  </header>

  <form action='/search' id='search-form' class='search-form'>
    <label>
      <span class='screen-reader-text'>Search</span>
      <input id='search-term' class='search-term' type='search' name='q' placeholder='Search&hellip;'>
    </label></form>

</section>
<section class='widget widget-sidebar_menu sep-after'><nav id='sidebar-menu' class='menu sidebar-menu' aria-label='Sidebar Menu'>
    <div class='container'>
      <ul><li class='item has-children has-current'>
  <a href='https://citizenken.github.io/reinvent_2018_notes/aws_reinvent_2018/'>AWS Re:Invent 2018</a><button class='sub-menu-toggler'>
    <span class='screen-reader-text'>expand sub menu</span>
    <span class='sign'></span>
  </button>

  <ul class='sub-menu'><li class='item'>
  <a href='https://citizenken.github.io/reinvent_2018_notes/aws_reinvent_2018/central_teams/'>Central Teams in DevOps Organizations</a></li><li class='item'>
  <a href='https://citizenken.github.io/reinvent_2018_notes/aws_reinvent_2018/amazon_devops/'>How Amazon Does Devops</a></li><li class='item current'>
  <a aria-current='page' href='https://citizenken.github.io/reinvent_2018_notes/aws_reinvent_2018/safe_serverless_deployments/'>Safe Deployments on AWS Lambda and Amazon API Gateway</a></li></ul></li></ul>
    </div>
  </nav>

</section><section class='widget widget-taxonomy_cloud sep-after'>
  <header>
    <h4 class='title widget-title'>Tags</h4>
  </header>

  <div class='container list-container'>
  <ul class='list taxonomy-cloud'><span>Not a single Tag!</span></ul>
</div>


</section>
</div>

  <div class='sidebar-overlay'></div>
</div><div class='main'><a class='screen-reader-text' href='#content'>Skip to Content</a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'>Toggle Sidebar</span>
  <span class='open'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="3" y1="12" x2="21" y2="12" />
  <line x1="3" y1="6" x2="21" y2="6" />
  <line x1="3" y1="18" x2="21" y2="18" />
  
</svg>
</span>
  <span class='close'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
  
</svg>
</span>
</button><div class='header-widgets'>
        <div class='container'>
    
    <style>.widget-breadcrumbs li:after{content:'\2f '}</style>
  <section class='widget widget-breadcrumbs sep-after'>
    <nav id='breadcrumbs'>
      <ol><li><a href='https://citizenken.github.io/reinvent_2018_notes/'>Home</a></li><li><a href='https://citizenken.github.io/reinvent_2018_notes/aws_reinvent_2018/'>AWS Re:Invent 2018</a></li><li><span>SRV343-R1: Best Practices for Safe Deployments on AWS Lambda and Amazon API Gateway</span></li></ol>
    </nav>
  </section></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>My New Hugo Site</p><p class='desc site-desc'>Minimalist theme for Hugo</p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>SRV343-R1: Best Practices for Safe Deployments on AWS Lambda and Amazon API Gateway</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='0001-01-01T00:00:00Z'>0001, Jan 01</time>
</span>

  
  

</div>


  </div>
</header>

  
  
<details class='container entry-toc'>
  <summary class='title'>
    <span>Table of Contents</span>
  </summary>
  
</details>


  <div class='container entry-content'>
  <ul>
<li>flexible schema much easier to deal with when using serverless

<ul>
<li>don&rsquo;t need to deal with updates</li>
</ul></li>
<li>lambda@the edge is like lamdba, but at the edge of your network, so it can do smarter routing to resources for ex.

<ul>
<li>for ex. feature flags to give beta version to a particular company</li>
</ul></li>

<li><p>when you update a lambda, it creates an immutable version ID</p>

<ul>
<li>Aliases can be defined and linked to version IDs</li>
<li>Allows for ex. evens to go to particular versions</li>
<li>allows for weight between versions

<ul>
<li>ex. prod points 95% of invocations @ v1, 5% @ v2, for canary testing</li>
<li>invocations are distributed in a round-robin fashion</li>
</ul></li>
<li>in SAM, can configure deployment strategy to funtions

<ul>
<li>allows automated weight manipulation</li>
<li>if no errors, keep ramping up (10 percent, increasing every 10 minutes for ex.)</li>
<li>requires monitoring

<ul>
<li>hooks and alarms (Cloudwatch alarm)</li>
<li>suggests to link canary metrics to customer action rather than just infrastructure</li>
<li>pre and post traffic functions that calls back to code deploy to accept/reject version</li>
</ul></li>
</ul></li>
</ul></li>

<li><p>similar weights can be added to API gateway to send traffic to certain API</p></li>
</ul>

<p>Life stages of Lambda development</p>

<p>V1:
* User manually configures the function in the UI
    * doesn&rsquo;t allow multiple users
    * not saved outside of the UI
V2:
* Something in git changes, that updates the lambda
V3:
* Similar to V2, but has multiple environments, with testing before prod
V4:
* similar to V3, but the testing portion is build out into canary deployments
* pre traffic hooks can fail deployments, so customers don&rsquo;t see any errors
* once the canaries are happy, 100% of traffic is on the new version</p>

<p>Why would we move to serverless when things are working currently
* serverless is easy to create a sandbox environment for external developer to play with
    * just define another SAM configuration
* more scalable because it&rsquo;s there automatically
* no idle capacity
* no server admin</p>

<ul>
<li><p>best practices</p>

<ul>
<li>function duration</li>
<li>control your retries</li>
<li>know your limits</li>
<li>use versioning</li>
<li>amazon cloudwatch - insert logging statements!</li>
<li>protect your Lambda functions with IAM roles

<ul>
<li>even like allowing only access to certain fields in a dynamo table</li>
</ul></li>
<li>plan for dependencies when setting timeout value</li>
<li>test test test - best way to turn functions is by testing</li>
</ul></li>

<li><p>evaluating the move to serverless is a good time to review current design and architecture</p>

<ul>
<li>ie. why use postgres if most queries are just lookups</li>
</ul></li>

<li><p>serverless and databases</p>

<ul>
<li>know your data</li>
<li>know the available cost model and match it to your needs</li>
<li>tests at scale</li>
<li>encryption</li>
<li>secure your flow - IAM roles</li>
</ul></li>

<li><p>lessons learned from journey to serverless</p>

<ul>
<li>think microservices</li>
<li>canary deployments</li>
<li>cold start

<ul>
<li>not as much of a problem as ppl say</li>
<li>aws adjusts cold starts over life of the function, learns about it</li>
<li>review design if cold starts are impacting you, ie. function runs once a day</li>
</ul></li>
<li>yes/no functions

<ul>
<li>keep functions simple</li>
</ul></li>
<li>events source</li>
<li>distributed tracing</li>
<li>environmental variables</li>
</ul></li>

<li><p>include this kind of stuff ^ in your MVP</p></li>
</ul>

<p>Why does Capital One use Go?
* Go&rsquo;s native concurrency is a boon for network applications that live and die on concurrency
* modern apps are designed to be cloud-native and to take advantage of loosely coupled cloud services</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'>
  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='next-entry sep-before'>
      <a href='https://citizenken.github.io/reinvent_2018_notes/aws_reinvent_2018/amazon_devops/'>
        <span class='screen-reader-text'>Next post: </span>How Amazon Does Devops<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/assets\/js\/'</script>

<script src='https://citizenken.github.io/reinvent_2018_notes/assets/js/main.fae8ed32.js'></script>

</body>

</html>

